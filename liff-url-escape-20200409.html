<!DOCTYPE html><html><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, viewport-fit=cover, user-scalable=no"><title>LIFF 沒有 escape 的錯誤</title><script async src="https://www.googletagmanager.com/gtag/js?id=UA-39556213-3"></script><script>window.dataLayer = window.dataLayer || []
function gtag () { dataLayer.push(arguments) } // eslint-disable-line
gtag('js', new Date())
gtag('config', 'UA-39556213-3')</script><script>(function () {
  const hostname = location.host.split(':')[0]
  if (hostname === 'localhost') document.write(`<script src="http://${hostname}:35729/livereload.js?snipver=1"></` + 'script>')
})()</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-default@3/default.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1/themes/prism-tomorrow.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@9/dist/sweetalert2.min.css"><style>[v-cloak] {
  display: none; }
</style></head><body><div class="container my-3" id="app" v-cloak><h2 class="text-center my-3">LIFF 沒有 escape 的錯誤</h2><h4 class="my-3">請將此連結複製到聊天視窗內貼上再打開</h4><div class="input-group my-3"><input class="form-control" type="url" ref="liff" :value="liff" readonly><div class="input-group-append"><button class="btn btn-outline-success" type="button" @click="btnCopy">複製</button><a class="btn btn-outline-success" :href="liff">開啟</a></div></div><h4 class="my-3">參數帶入結果</h4><pre class="my-3"><code class="language-json">{{ code }}</code></pre><button class="my-3 btn btn-block btn-outline-primary" type="button" @click="btnLiffInit">點此執行 liff.init</button><h4 class="my-3">Google Maps 的網址應該要是</h4><pre class="my-3"><code class="language-none">{{ gmap }}</code></pre></div><script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/json5@2/dist/index.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lodash@4/lodash.min.js"></script><script src="https://cdn.jsdelivr.net/npm/papaparse@5/papaparse.min.js"></script><script src="https://cdn.jsdelivr.net/npm/popper.js@1/dist/umd/popper.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-core.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1/plugins/autoloader/prism-autoloader.min.js"></script><script src="https://cdn.jsdelivr.net/npm/qs@6/dist/qs.min.js"></script><script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script><script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.min.js"></script><!-- bootstrap require jquery and pupper--><script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vconsole@3/dist/vconsole.min.js"></script><script src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script><script>const vConsole = new VConsole() // eslint-disable-line
const genGoogleMapUrl = (query, queryPlaceId) => {
  const gmap = new URL('https://www.google.com/maps/search/')
  gmap.searchParams.set('api', '1')
  gmap.searchParams.set('query', query)
  if (queryPlaceId) gmap.searchParams.set('query_place_id', queryPlaceId)
  return gmap.href
}
const vm = new Vue({ // eslint-disable-line
  el: '#app',
  data: {
    code: '',
    gmap: genGoogleMapUrl('24.959276,121.419008', 'ChIJ40_T2-scaDQRF36Y2c_qORY'),
    liff: '',
  },
  async mounted () {
    this.liff = this.genLiffUrl(this.gmap)
    const liffState = this.getSearchParams(location.href, 'liff.state')
    this.code = JSON.stringify({
      locationSearch: location.search,
      liffState,
      gmapFromLiffState: this.getSearchParams(new URL(liffState, 'https://localhost'), 'u'),
      gmapFromLocationSearch: this.getSearchParams(location.href, 'u'),
    }, null, 2)
  },
  methods: {
    async btnLiffInit () {
      await liff.init({ liffId: '1654046335-48OjmpAl' })
    },
    getSearchParams (url, name) {
      return new URL(url).searchParams.get(name)
    },
    genLiffUrl (u) {
      const url = new URL('https://liff.line.me/1654046335-48OjmpAl/pug/liff-url-escape-20200409.html')
      url.searchParams.set('u', u)
      return url.href
    },
    async btnCopy () {
      const copyText = this.$refs.liff
      copyText.select()
      copyText.setSelectionRange(0, 99999) // For mobile devices
      document.execCommand('copy')
      await Swal.fire({
        icon: 'success',
        title: '複製成功',
      })
    },
  },
})</script></body></html>